---
alwaysApply: true
---

# Meeting Plunger - Cursor Rules

## CRITICAL: Nix Environment

**ALWAYS prefix ALL commands with `nix develop -c`**

This project uses Nix for reproducible development. Never run commands directly.

### Examples:
```bash
# ❌ WRONG
pnpm sut
pnpm e2e

# ✅ CORRECT
nix develop -c pnpm sut
nix develop -c pnpm e2e
```

## Quick Commands

### Start Services (System Under Test)
```bash
nix develop -c pnpm sut
```
Starts backend (Python/FastAPI on :8000) and frontend (Vue on :3000) with color-coded logs.

### Run E2E Tests
```bash
nix develop -c pnpm e2e         # Headless
nix develop -c pnpm e2e:headed  # With browser
nix develop -c pnpm e2e:debug   # Debug mode
```

### Individual Services
```bash
nix develop -c pnpm sut:backend   # Backend only
nix develop -c pnpm sut:frontend  # Frontend only
```

## Project Structure

- `backend/` - Python FastAPI backend
- `frontend/` - Vue.js frontend (proxies API to backend)
- `e2e/` - Playwright + Cucumber (Gherkin) tests
- `.vscode/` - VSCode settings with Cucumber plugin config

## Development Workflow

1. **Start services**: `nix develop -c pnpm sut` (Terminal 1)
2. **Run tests**: `nix develop -c pnpm e2e` (Terminal 2)
3. **Make changes** to code
4. **Re-run tests**: Services auto-reload

**TDD + 提交**：开发时先写/改测试（红）→ 最小实现（绿）→ 按计划小步提交。详见 `rules/tdd-and-commits.mdc`。

## Testing

- Feature files: `e2e/features/*.feature`
- Step definitions: `e2e/steps/*.steps.js`
- Support code: `e2e/support/world.js`

## Key Points

- **ALWAYS use `nix develop -c` prefix** for commands
- Backend auto-reloads on changes (uvicorn --reload)
- Frontend auto-reloads on changes (Vite HMR)
- E2E tests require backend and frontend running
- Use `pnpm sut` for simplest workflow (starts both services)

## Documentation

- `docs/QUICK_START.md` - Quick reference
- `docs/VSCODE_SETUP.md` - VSCode + Cucumber setup
- `e2e/README.md` - E2E testing guide
